[workspace]
name = "poly-tri"
version = "0.0"
description = "triangolosierer"
channels = ["conda-forge"]
platforms = ["linux-64", "osx-64", "osx-arm64", "win-64"]

[dependencies]
python = ">=3.8"
numpy = "*"
matplotlib = "*"
pytest  = "*"

[feature.lint.dependencies]
pylint = "*"

[feature.build.dependencies]
# Needed for building Rust code
compilers = ">=1.11.0,<2"
git = ">=2.51.0,<3"
openssl = ">=3.5.4,<4"
pkg-config = ">=0.29.2,<0.30"
rust-src = ">=1.90.0,<2"
maturin = ">=1.11.0,<2"
rust = ">=1.90.0,<1.91"
pip = ">=25.3,<26"
# Python dependencies for testing
python = ">=3.8"
numpy = "*"
matplotlib = "*"
pytest = "*"

[feature.build.target.linux.dependencies]
clang = ">=21.1.2,<22"
compilers = ">=1.6.0"
make = ">=4.4.1,<5"

[feature.build.target.win-64.dependencies]
vs2017_win-64 = ">=19.16.27033,<20"

[tasks]
test = "python -m pytest tests/ || python tests/test.py"
speedtest = "python tests/speedtest.py"

[feature.lint.tasks]
lint = "python -m pylint polytri.py || echo 'pylint not installed'"

[feature.build.tasks]
build-debug = "cd rust && maturin develop --features python"
build = "cd rust && maturin develop --release --features python"
check = "cd rust && cargo check"
test-rust = "cd rust && cargo test"
fmt = "cd rust && cargo fmt"
lint-rust = "cd rust && cargo clippy"
clean = "cd rust && cargo clean && rm -rf target/ dist/ *.egg-info"

[feature.build.activation]
env.CARGO_TARGET_DIR = "rust/target/pixi"
env.PYO3_USE_ABI3_FORWARD_COMPATIBILITY = "1"

[environments]
build = { features = ["build"]}
lint = { features = ["lint"]}

